<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>研究紹介 | 松本崚佑</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
  <style>
    :root{
      --primary:#2c3e50;
      --accent:#18bc9c;
      --bg:#ecf0f1;
      --white:#ffffff;
      --dark:#1a1a1a;
    }
    *,*::before,*::after{box-sizing:border-box;}
    body{margin:0;font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--dark);}  
    header,footer{background:var(--primary);color:#fff;text-align:center;padding:1rem 0;}
    a{color:var(--accent);text-decoration:none;}
    main{max-width:1000px;margin:2rem auto;padding:0 1.5rem;}
    h1{margin:0;font-size:2.2rem;font-family:'Montserrat',sans-serif;}
    h2{margin-top:3rem;font-size:1.6rem;color:var(--primary);}    
    section{background:#fff;padding:1.5rem 2rem;border-radius:8px;box-shadow:0 4px 10px rgba(0,0,0,.05);margin-bottom:2.5rem;position:relative;}
    canvas,svg{display:block;margin:1rem auto;max-width:100%;border:1px solid #ddd;border-radius:6px;background:#fff;}
    .caption{font-size:.9rem;color:#666;text-align:center;}
    .step-label{position:absolute;top:-1.2rem;left:1rem;background:var(--accent);color:#fff;padding:.1rem .5rem;border-radius:4px;font-size:.8rem;font-weight:700;}
  </style>
</head>
<body>
  <header>
    <h1>研究紹介</h1>
    <nav><a href="index.html">← トップへ戻る</a></nav>
  </header>
  <main>

    <!-- Step 1 -------------------------------------------------------------- -->
    <section id="step1">
      <span class="step-label">STEP&nbsp;1</span>
      <h2>心電図欠損補完に生成 AI を応用</h2>
      <p>欠損した心電図（ECG）波形を入力し、<strong>欠損していない前後の部分</strong>を条件として生成 AI が<br>欠損部分を推定・補完する手法を開発しています。</p>
      <!-- ECG Animation Canvas -->
      <canvas id="ecgCanvas" width="800" height="220"></canvas>
      <p class="caption">欠損波形（グレー）を生成 AI が補完（グリーン）するイメージ</p>
    </section>

    <!-- Step 2 -------------------------------------------------------------- -->
    <section id="step2">
      <span class="step-label">STEP&nbsp;2</span>
      <h2>ブラックボックス問題と信頼性</h2>
      <p>しかし、生成 AI が<strong>どのような特徴を手がかりに波形を生成したのか</strong>が分からないため、<br>医学・薬学への応用では <em>Explainability（説明可能性）</em> が課題となります。</p>
      <svg id="blackboxSvg" viewBox="0 0 640 200" width="800" height="200">
        <style>
          .arrow{fill:none;stroke:var(--primary);stroke-width:3;marker-end:url(#arrowhead);} 
          .input{fill:#cfcfcf;} .box{fill:var(--primary);} .output{fill:var(--accent);} 
          text{fill:#fff;font-size:14px;font-family:'Noto Sans JP',sans-serif;dominant-baseline:middle;text-anchor:middle;}
        </style>
        <defs>
          <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="var(--primary)" />
          </marker>
        </defs>
        <!-- 左: 入力ECG -->
        <rect x="20" y="60" width="140" height="80" class="input" rx="6"/>
        <text x="90" y="100">入力 ECG</text>
        <!-- 渦巻き矢印（ベジェで軽いうずを描く） -->
        <path d="M160 100 C 220 20 300 180 360 100" class="arrow" />
        <!-- ブラックボックス -->
        <rect x="360" y="40" width="120" height="120" class="box" rx="8"/>
        <text x="420" y="100">生成&nbsp;AI<br>(ブラック<br>ボックス)</text>
        <!-- 渦巻き矢印（出力側） -->
        <path d="M480 100 C 540 180 600 20 640 100" class="arrow" />
        <!-- 右: 欠損部ECG -->
        <rect x="640" y="60" width="140" height="80" class="output" rx="6"/>
        <text x="710" y="100">欠損部 ECG</text>
      </svg>
     
    </section>

    <!-- Step 3 -------------------------------------------------------------- -->
    <section id="step3">
      <span class="step-label">STEP&nbsp;3</span>
      <h2>重要領域の可視化による Explainability 向上</h2>
      <p>生成 AI が<strong>入力波形のどこを重視して欠損部を生成したか</strong>を可視化し、<br>医療者が直感的に信頼度を判断できるようにする研究を行いました。</p>
      <canvas id="attentionCanvas" width="800" height="220"></canvas>
      <p class="caption">生成された欠損部（太線）がどこを注目して生成されたのか可視化するイメージ
      </p>
    </section>

  </main>
  <footer>© 2025 松本崚佑</footer>

  <script>
    const ACCENT=getComputedStyle(document.documentElement).getPropertyValue('--accent');

    /* ---------------- ECG Animation (Step 1) - loop ---------------- */
    (function(){
      const canvas=document.getElementById('ecgCanvas');
      if(!canvas)return;
      const ctx=canvas.getContext('2d');
      const W=canvas.width, H=canvas.height, baseline=H/2;
      const points=[]; const cycle=160; // pixels per heartbeat
      for(let x=0;x<=W;x++){
        const phase=x%cycle; let y=baseline;
        if(phase<15) y-=30*(1-phase/15);
        else if(phase<25) y-=30+50*(phase-15)/10;
        else if(phase<45) y+=60*((phase-25)/20);
        else if(phase<55) y-=40*((phase-45)/10);
        else if(phase<95) y-=10*Math.sin((phase-55)/40*Math.PI);
        points.push({x,y});
      }
      const start=300,end=450,duration=1500; // ms
      function drawBase(){
        ctx.clearRect(0,0,W,H);
        ctx.lineWidth=2; ctx.lineJoin='round';
        ctx.strokeStyle='#c0c0c0';
        ctx.beginPath(); ctx.moveTo(0,points[0].y);
        for(let i=1;i<points.length;i++){
          if(i===start){ctx.stroke();ctx.beginPath();ctx.moveTo(end,points[end].y);continue;}
          if(i>start&&i<end)continue;
          ctx.lineTo(points[i].x,points[i].y);
        }
        ctx.stroke();
      }
      drawBase();
      let prevLen=0; let lastTime=0;
      function animate(timestamp){
        if(!lastTime) lastTime=timestamp;
        const elapsed=(timestamp-lastTime)%duration;
        const progress=elapsed/duration;
        const len=Math.floor(progress*(end-start));
        // clear previous overlay
        ctx.clearRect(start-2,0,(end-start)+4,H);
        ctx.strokeStyle=ACCENT.trim(); ctx.lineWidth=2;
        ctx.beginPath(); ctx.moveTo(start,points[start].y);
        for(let i=1;i<=len;i++) ctx.lineTo(start+i,points[start+i].y);
        ctx.stroke();
        requestAnimationFrame(animate);
      }
      requestAnimationFrame(animate);
    })();

    /* ---------------- Attention Heatmap & Generated Segment (Step 3) ------------ */
    (function(){
      const canvas=document.getElementById('attentionCanvas'); if(!canvas)return;
      const ctx=canvas.getContext('2d'); const W=canvas.width,H=canvas.height,baseline=H/2;
      const points=[]; const cycle=160; for(let x=0;x<=W;x++){
        const phase=x%cycle; let y=baseline;
        if(phase<15) y-=30*(1-phase/15);
        else if(phase<25) y-=30+50*(phase-15)/10;
        else if(phase<45) y+=60*((phase-25)/20);
        else if(phase<55) y-=40*((phase-45)/10);
        else if(phase<95) y-=10*Math.sin((phase-55)/40*Math.PI);
        points.push({x,y});
      }
      const start=300,end=450;
      // draw full waveform (grey)
      ctx.lineWidth=1.8; ctx.strokeStyle='#666'; ctx.beginPath(); ctx.moveTo(0,points[0].y);
      for(const p of points) ctx.lineTo(p.x,p.y); ctx.stroke();
      // draw generated segment overlay (bold green)
      ctx.lineWidth=2.5; ctx.strokeStyle=ACCENT.trim(); ctx.beginPath(); ctx.moveTo(start,points[start].y);
      for(let i=start+1;i<=end;i++) ctx.lineTo(points[i].x,points[i].y); ctx.stroke();
      // fake sparse attention weights (largely zeros)
      const weights=points.map(()=>Math.random()<0.15?Math.random():0); // 15% non‑zero
      const max=Math.max(...weights);
      const barWidth=4;
      let idx=0; function drawBar(){
        if(idx>=points.length){return;}
        const alpha=(weights[idx]/(max||1))*0.6;
        if(alpha>0){
          ctx.fillStyle=`rgba(24,188,156,${alpha})`;
          ctx.fillRect(points[idx].x-barWidth/2,0,barWidth,H);
        }
        idx+=4; requestAnimationFrame(drawBar);
      }
      drawBar();
    })();
  </script>
</body>
</html>
